name: æ›´æ–°å¹´åº¦è¿›åº¦æ¡
on:
  # æ¯å¤©å‡Œæ™¨ 0 ç‚¹è‡ªåŠ¨è¿è¡Œï¼ˆUTC æ—¶é—´ï¼Œå¯¹åº”åŒ—äº¬æ—¶é—´æ—© 8 ç‚¹ï¼‰
  schedule:
    - cron: '0 0 * * *'
  # ä¹Ÿå¯ä»¥æ‰‹åŠ¨è§¦å‘ï¼ˆå¯é€‰ï¼‰
  workflow_dispatch:

jobs:
  update-progress:
    runs-on: ubuntu-latest
    steps:
      # 1. å…‹éš†ä½ çš„ä»“åº“åˆ°æœåŠ¡å™¨
      - name: æ‹‰å–ä»“åº“ä»£ç 
        uses: actions/checkout@v4

      # 2. å®‰è£… Pythonï¼ˆç”¨æ¥è®¡ç®—è¿›åº¦ï¼‰
      - name: è®¾ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 3. è¿è¡Œè®¡ç®—è„šæœ¬ï¼Œæ›´æ–° README
      - name: è®¡ç®—å¹¶æ›´æ–°å¹´åº¦è¿›åº¦
        run: |
          # ç¼–å†™ Python è®¡ç®—è„šæœ¬ï¼ˆä¸´æ—¶æ–‡ä»¶ï¼‰
          cat > calculate_progress.py << 'EOF'
          import datetime
          import re

          # è·å–å½“å‰æ—¥æœŸå’Œå…¨å¹´å¤©æ•°
          today = datetime.date.today()
          year = today.year
          # åˆ¤æ–­æ˜¯å¦æ˜¯é—°å¹´
          if (year % 4 == 0 and year % 100 != 0) or (year % 400 == 0):
              total_days = 366
          else:
              total_days = 365
          # è®¡ç®—å·²è¿‡å¤©æ•°å’Œç™¾åˆ†æ¯”ï¼ˆä¿ç•™ä¸¤ä½å°æ•°ï¼‰
          days_passed = (today - datetime.date(year, 1, 1)).days + 1
          progress_percent = round((days_passed / total_days) * 100, 2)
          # æ ¼å¼åŒ–æ—¥æœŸï¼ˆæ¯”å¦‚ 6-Jan-2026ï¼‰
          date_str = today.strftime("%d-%b-%Y")

          # è¯»å– README æ–‡ä»¶
          with open("README.md", "r", encoding="utf-8") as f:
              content = f.read()

          # æ›¿æ¢ç™¾åˆ†æ¯”å’Œæ—¥æœŸæ ‡è®°
          content = re.sub(r'<!--YEAR_PROGRESS_PERCENT-->', f'{progress_percent}%', content)
          content = re.sub(r'<!--YEAR_PROGRESS_DATE-->', date_str, content)

          # å†™å› README æ–‡ä»¶
          with open("README.md", "w", encoding="utf-8") as f:
              f.write(content)
          EOF

          # æ‰§è¡Œè„šæœ¬
          python calculate_progress.py

      # 4. æäº¤å¹¶æ¨é€ä¿®æ”¹åˆ°ä»“åº“ï¼ˆä¿®æ”¹åçš„æˆæƒç‰ˆæœ¬ï¼‰
      - name: æäº¤æ›´æ–°
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "action@github.com"
          git add README.md
          # åªæœ‰æ–‡ä»¶æœ‰ä¿®æ”¹æ—¶æ‰æäº¤
          git diff --quiet && git diff --staged --quiet || git commit -m "ğŸ¤– è‡ªåŠ¨æ›´æ–°å¹´åº¦è¿›åº¦æ¡: $(date +'%Y-%m-%d')"
          # å…³é”®ä¿®æ”¹ï¼šç”¨ GITHUB_TOKEN æˆæƒæ¨é€
          git push "https://${{ github.actor }}:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git"